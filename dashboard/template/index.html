<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quotex Trading Bot Dashboard</title>
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-card h3 {
            margin: 0;
            color: #7f8c8d;
            font-size: 14px;
        }
        .stat-card .value {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        .profit {
            color: #27ae60;
        }
        .loss {
            color: #e74c3c;
        }
        .signals {
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .signal {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            gap: 10px;
            align-items: center;
        }
        .signal-header {
            font-weight: bold;
            background: #f8f9fa;
            position: sticky;
            top: 0;
        }
        .buy {
            color: #27ae60;
            font-weight: bold;
        }
        .sell {
            color: #e74c3c;
            font-weight: bold;
        }
        .confidence-bar {
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #f39c12, #27ae60);
            border-radius: 10px;
        }
        .confidence-text {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            text-align: center;
            color: #2c3e50;
            font-weight: bold;
            font-size: 12px;
            line-height: 20px;
        }
        .charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .status {
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .status-online {
            color: #27ae60;
            font-weight: bold;
        }
        .status-offline {
            color: #e74c3c;
            font-weight: bold;
        }
        @media (max-width: 768px) {
            .signal {
                grid-template-columns: 1fr;
                gap: 5px;
            }
            .charts {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Quotex Trading Bot Dashboard</h1>
            <p>Real-time trading signals and performance monitoring</p>
        </div>

        <div class="status">
            <h2>System Status: <span id="status" class="status-online">Online</span></h2>
            <p>Connected Clients: <span id="clients">0</span></p>
            <p>Last Update: <span id="last-update">-</span></p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <h3>Total Signals</h3>
                <div class="value" id="total-signals">0</div>
            </div>
            <div class="stat-card">
                <h3>Winning Signals</h3>
                <div class="value profit" id="winning-signals">0</div>
            </div>
            <div class="stat-card">
                <h3>Losing Signals</h3>
                <div class="value loss" id="losing-signals">0</div>
            </div>
            <div class="stat-card">
                <h3>Total Profit</h3>
                <div class="value profit" id="total-profit">$0.00</div>
            </div>
            <div class="stat-card">
                <h3>Win Rate</h3>
                <div class="value" id="win-rate">0%</div>
            </div>
        </div>

        <div class="charts">
            <div class="chart-container">
                <h3>Performance Chart</h3>
                <canvas id="performance-chart" width="400" height="200"></canvas>
            </div>
            <div class="chart-container">
                <h3>Signal Distribution</h3>
                <canvas id="distribution-chart" width="400" height="200"></canvas>
            </div>
        </div>

        <div class="signals">
            <h2>Recent Trading Signals</h2>
            <div class="signal signal-header">
                <div>Time</div>
                <div>Asset</div>
                <div>Signal</div>
                <div>Timeframe</div>
                <div>Confidence</div>
            </div>
            <div id="signals-container">
                <!-- Signals will be added here dynamically -->
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let performanceChart = null;
        let distributionChart = null;

        // Update performance stats
        socket.on('performance_update', function(data) {
            document.getElementById('total-signals').textContent = data.total_signals;
            document.getElementById('winning-signals').textContent = data.winning_signals;
            document.getElementById('losing-signals').textContent = data.losing_signals;
            document.getElementById('total-profit').textContent = '$' + data.total_profit.toFixed(2);
            
            const winRate = data.total_signals > 0 ? 
                ((data.winning_signals / data.total_signals) * 100).toFixed(1) : 0;
            document.getElementById('win-rate').textContent = winRate + '%';
            
            updateCharts(data);
        });

        // Add new signal
        socket.on('new_signal', function(signal) {
            const signalsContainer = document.getElementById('signals-container');
            const signalElement = document.createElement('div');
            signalElement.className = 'signal';
            
            signalElement.innerHTML = `
                <div>${signal.timestamp}</div>
                <div>${signal.asset}</div>
                <div class="${signal.direction.toLowerCase()}">${signal.direction}</div>
                <div>${signal.timeframe}</div>
                <div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: ${signal.confidence}%"></div>
                        <div class="confidence-text">${signal.confidence}%</div>
                    </div>
                </div>
            `;
            
            signalsContainer.insertBefore(signalElement, signalsContainer.firstChild);
            
            // Keep only last 20 signals visible
            if (signalsContainer.children.length > 20) {
                signalsContainer.removeChild(signalsContainer.lastChild);
            }
            
            // Update last update time
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
        });

        // Update connected clients count
        socket.on('connect', function() {
            document.getElementById('status').textContent = 'Online';
            document.getElementById('status').className = 'status-online';
        });

        socket.on('disconnect', function() {
            document.getElementById('status').textContent = 'Offline';
            document.getElementById('status').className = 'status-offline';
        });

        socket.on('clients_update', function(count) {
            document.getElementById('clients').textContent = count;
        });

        // Initialize charts
        function initCharts() {
            const performanceCtx = document.getElementById('performance-chart').getContext('2d');
            performanceChart = new Chart(performanceCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Account Balance',
                        data: [],
                        borderColor: '#27ae60',
                        tension: 0.1,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });

            const distributionCtx = document.getElementById('distribution-chart').getContext('2d');
            distributionChart = new Chart(distributionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['BUY', 'SELL'],
                    datasets: [{
                        data: [0, 0],
                        backgroundColor: ['#27ae60', '#e74c3c']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        // Update charts with new data
        function updateCharts(data) {
            // Update performance chart (simplified)
            if (performanceChart) {
                const newLabel = new Date().toLocaleTimeString();
                performanceChart.data.labels.push(newLabel);
                performanceChart.data.datasets[0].data.push(data.total_profit);
                
                // Keep only last 20 data points
                if (performanceChart.data.labels.length > 20) {
                    performanceChart.data.labels.shift();
                    performanceChart.data.datasets[0].data.shift();
                }
                
                performanceChart.update();
            }

            // Update distribution chart (simplified)
            if (distributionChart) {
                // This would need actual buy/sell count data
                distributionChart.update();
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
            
            // Load initial data
            fetch('/api/signals')
                .then(response => response.json())
                .then(signals => {
                    const container = document.getElementById('signals-container');
                    signals.forEach(signal => {
                        const signalElement = document.createElement('div');
                        signalElement.className = 'signal';
                        signalElement.innerHTML = `
                            <div>${signal.timestamp}</div>
                            <div>${signal.asset}</div>
                            <div class="${signal.direction.toLowerCase()}">${signal.direction}</div>
                            <div>${signal.timeframe}</div>
                            <div>
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: ${signal.confidence}%"></div>
                                    <div class="confidence-text">${signal.confidence}%</div>
                                </div>
                            </div>
                        `;
                        container.appendChild(signalElement);
                    });
                });

            fetch('/api/performance')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('total-signals').textContent = data.total_signals;
                    document.getElementById('winning-signals').textContent = data.winning_signals;
                    document.getElementById('losing-signals').textContent = data.losing_signals;
                    document.getElementById('total-profit').textContent = '$' + data.total_profit.toFixed(2);
                    
                    const winRate = data.total_signals > 0 ? 
                        ((data.winning_signals / data.total_signals) * 100).toFixed(1) : 0;
                    document.getElementById('win-rate').textContent = winRate + '%';
                });
        });
    </script>
</body>
</html>
